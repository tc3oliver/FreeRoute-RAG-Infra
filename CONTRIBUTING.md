# Contributing

Thanks for your interest! For small issues and typos, feel free to open a PR directly.

- Branch from: main
- Run lint locally (optional): ruff check .
- Avoid committing .env or secrets
- Keep PRs focused; add tests when changing behavior

## Development tips

- Use docker compose up -d --build to start services.
- tests/ 目錄包含最小的 smoke 測試（gateway 與 reranker 健康檢查）。
- For GPU issues, see Troubleshooting in README.

## Pre-commit hooks (ruff/black/isort)

This repo ships with pre-commit to keep style consistent.

Setup once:

```bash
pip install pre-commit
pre-commit install
```

Run on all files before pushing:

```bash
pre-commit run --all-files
```

Tools and config:

CI will also run pre-commit on PRs via .github/workflows/pre-commit.yml.


### Pre-commit & running tests on commit

The project config runs a local `pytest` hook during commit so unit tests in `tests/unit` are executed in an isolated venv before the commit completes. Notes:

- Install pre-commit once (per environment):

```bash
pip install pre-commit
pre-commit install
```

- First commit after installing the hooks may be slower because the hook's venv will download the declared test/runtime dependencies (pytest, pytest-asyncio, openai, redis, requests, ...). This happens only once per machine/hook environment.

- If you need to skip hooks for a quick commit (not recommended for feature branches), use `--no-verify` with `git commit`.

- If running full unit tests on every commit is too slow for your workflow, consider switching the hook to run on push (change `stages: [commit]` to `stages: [push]`) or make the hook run a smaller test subset.

If you want me to update the repo to use pre-push instead of commit-stage tests, tell me and I will change the hook config and update this doc.
## Releases and tags

We use tag-driven releases on GitHub.

- Create a conventional tag (e.g., v0.2.0):

```bash
git tag v0.2.0
git push origin v0.2.0
```

- A GitHub Release will be created with autogenerated notes (see .github/workflows/release.yml).
- Optionally update CHANGELOG.md in the same PR before tagging.

Versioning guideline:
- Follow SemVer where practical (major.minor.patch).
- Breaking changes => major; features => minor; fixes/docs => patch.

## Dependabot

Dependency updates are automated via .github/dependabot.yml.
- Schedules weekly checks for GitHub Actions, pip (root and services/gateway), and Dockerfiles.
- PRs will be labeled with dependencies category.

## Commit messages & PRs

- Keep subject concise; add context in the body when needed.
- Reference issues using #<id> when applicable.
- Squash-and-merge is preferred for small PRs.
