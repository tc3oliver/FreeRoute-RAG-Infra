# FreeRoute RAG Infra - ç³»çµ±æ¶æ§‹è¨­è¨ˆ

> **ç‰ˆæœ¬**: v0.1.2
> **æœ€å¾Œæ›´æ–°**: 2025-10-18
> **èªè¨€**: [ç¹é«”ä¸­æ–‡](#) | [English](architecture.en.md)

## ğŸ“‘ ç›®éŒ„

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ¶æ§‹ç¸½è¦½](#æ¶æ§‹ç¸½è¦½)
- [æ ¸å¿ƒçµ„ä»¶](#æ ¸å¿ƒçµ„ä»¶)
- [æ•¸æ“šæµç¨‹](#æ•¸æ“šæµç¨‹)
- [æŠ€è¡“é¸å‹](#æŠ€è¡“é¸å‹)
- [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)
- [æ€§èƒ½è€ƒé‡](#æ€§èƒ½è€ƒé‡)
- [å®‰å…¨è¨­è¨ˆ](#å®‰å…¨è¨­è¨ˆ)
- [æ“´å±•æ€§è¨­è¨ˆ](#æ“´å±•æ€§è¨­è¨ˆ)

---

## æ¦‚è¿°

FreeRoute RAG Infra æ˜¯ä¸€å€‹ç”Ÿç”¢å°±ç·’çš„ GraphRAGï¼ˆGraph-based Retrieval-Augmented Generationï¼‰åŸºç¤è¨­æ–½ï¼Œæ—¨åœ¨æä¾›ï¼š

- ğŸš€ **é›¶æˆæœ¬é‹è¡Œ**ï¼šå„ªå…ˆä½¿ç”¨å…è²» API é…é¡å’Œæœ¬åœ°æ¨ç†
- ğŸ”§ **å³æ’å³ç”¨**ï¼šDocker Compose ä¸€éµéƒ¨ç½²
- ğŸŒ **ç”Ÿç”¢å°±ç·’**ï¼šå®Œæ•´çš„ç›£æ§ã€æ—¥èªŒå’ŒéŒ¯èª¤è™•ç†
- ğŸ”— **æ¡†æ¶ä¸­ç«‹**ï¼šOpenAI ç›¸å®¹ APIï¼Œå¯èˆ‡ä»»ä½• LLM æ¡†æ¶æ•´åˆ

### æ ¸å¿ƒåŠŸèƒ½

- **æ··åˆæª¢ç´¢**ï¼šå‘é‡æª¢ç´¢ï¼ˆQdrantï¼‰+ çŸ¥è­˜åœ–è­œï¼ˆNeo4jï¼‰
- **æ™ºèƒ½è·¯ç”±**ï¼šå¤š LLM ä¾›æ‡‰å•†è‡ªå‹•åˆ‡æ›å’Œå›é€€
- **Token æ§åˆ¶**ï¼šæ¯æ—¥ç”¨é‡ä¸Šé™å’Œè‡ªå‹• fallback
- **æœ¬åœ°æ¨ç†**ï¼šOllama åµŒå…¥ + PyTorch Reranker

---

## æ¶æ§‹ç¸½è¦½

### ç³»çµ±å±¤æ¬¡æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ¶ç«¯æ‡‰ç”¨å±¤                              â”‚
â”‚  (LangChain / LlamaIndex / Custom Apps / Streamlit / ...)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP/REST API
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway (Port 9800)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ è·¯ç”±å±¤ (FastAPI)                                         â”‚  â”‚
â”‚  â”‚  â€¢ èªè­‰ & æˆæ¬Š (API Key)                                    â”‚  â”‚
â”‚  â”‚  â€¢ è«‹æ±‚è¿½è¹¤ (X-Request-ID)                                  â”‚  â”‚
â”‚  â”‚  â€¢ çµæ§‹åŒ–æ—¥èªŒ                                               â”‚  â”‚
â”‚  â”‚  â€¢ Prometheus æŒ‡æ¨™                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                  â”‚
              â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  LLM Proxy å±¤    â”‚ â”‚   æª¢ç´¢æœå‹™å±¤     â”‚ â”‚   åœ–è­œæœå‹™å±¤     â”‚
    â”‚   (LiteLLM)     â”‚ â”‚                 â”‚ â”‚                 â”‚
    â”‚  Port 9400      â”‚ â”‚                 â”‚ â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼               â–¼         â–¼         â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚OpenAI  â”‚    â”‚ Gemini   â”‚ â”‚Qdrantâ”‚ â”‚ Ollama  â”‚   â”‚  Neo4j   â”‚
  â”‚        â”‚    â”‚          â”‚ â”‚Vectorâ”‚ â”‚Embeddingâ”‚   â”‚  Graph   â”‚
  â”‚ (Cloud)â”‚    â”‚ (Cloud)  â”‚ â”‚  DB  â”‚ â”‚ (Local) â”‚   â”‚    DB    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚         â”‚          â”‚              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Reranker       â”‚
                    â”‚   (PyTorch)      â”‚
                    â”‚   Port 9080      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Redis          â”‚
                    â”‚   (å¿«å– & çµ±è¨ˆ)   â”‚
                    â”‚   Port 9379      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PostgreSQL     â”‚
                    â”‚   (LiteLLM é…ç½®)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çµ„ä»¶é€šè¨Šå”è­°

| ä¾†æº | ç›®æ¨™ | å”è­° | ç”¨é€” |
|------|------|------|------|
| Client | Gateway | HTTP/REST | API èª¿ç”¨ |
| Gateway | LiteLLM | HTTP/REST | LLM æ¨ç† |
| Gateway | Qdrant | HTTP/REST | å‘é‡æª¢ç´¢ |
| Gateway | Neo4j | Bolt/HTTP | åœ–è­œæŸ¥è©¢ |
| Gateway | Ollama | HTTP/REST | æœ¬åœ°åµŒå…¥ |
| Gateway | Reranker | HTTP/REST | çµæœé‡æ’ |
| LiteLLM | Redis | Redis Protocol | Token çµ±è¨ˆ |
| LiteLLM | PostgreSQL | PostgreSQL | é…ç½®å„²å­˜ |

---

## æ ¸å¿ƒçµ„ä»¶

### 1. API Gateway (services/gateway/)

**è·è²¬**ï¼š
- å°å¤–çµ±ä¸€å…¥å£ï¼Œæä¾› RESTful API
- è·¯ç”±è«‹æ±‚åˆ°ä¸åŒçš„æœå‹™å±¤
- API Key èªè­‰å’Œæˆæ¬Š
- è«‹æ±‚è¿½è¹¤å’Œæ—¥èªŒ
- Prometheus æŒ‡æ¨™æ”¶é›†

**æŠ€è¡“æ£§**ï¼š
- FastAPI (ASGI Web Framework)
- Pydantic (è³‡æ–™é©—è­‰)
- Python 3.10+

**é—œéµæ¨¡çµ„**ï¼š
```
gateway/
â”œâ”€â”€ app.py              # FastAPI æ‡‰ç”¨å…¥å£
â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”œâ”€â”€ deps.py             # ä¾è³´æ³¨å…¥ï¼ˆèªè­‰ï¼‰
â”œâ”€â”€ middleware.py       # ä¸­é–“ä»¶ï¼ˆè¿½è¹¤ã€æ—¥èªŒã€æŒ‡æ¨™ï¼‰
â”œâ”€â”€ models.py           # Pydantic æ¨¡å‹
â”œâ”€â”€ utils.py            # å·¥å…·å‡½æ•¸
â”œâ”€â”€ routers/            # API è·¯ç”±
â”‚   â”œâ”€â”€ chat.py         # /chat, /embed, /rerank
â”‚   â”œâ”€â”€ vector.py       # /index/chunks, /search, /retrieve
â”‚   â”œâ”€â”€ graph.py        # /graph/extract, /graph/query, ...
â”‚   â””â”€â”€ meta.py         # /health, /version, /metrics, /whoami
â”œâ”€â”€ services/           # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”œâ”€â”€ chat_service.py
â”‚   â”œâ”€â”€ vector_service.py
â”‚   â””â”€â”€ graph_service.py
â””â”€â”€ repositories/       # è³‡æ–™è¨ªå•å±¤
    â”œâ”€â”€ litellm_client.py
    â”œâ”€â”€ qdrant_client.py
    â”œâ”€â”€ neo4j_client.py
    â””â”€â”€ reranker_client.py
```

**API ç«¯é»**ï¼š

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/health` | GET | å¥åº·æª¢æŸ¥ | âŒ |
| `/version` | GET | ç‰ˆæœ¬è³‡è¨Š | âŒ |
| `/whoami` | GET | é…ç½®è³‡è¨Š | âœ… |
| `/metrics` | GET | Prometheus æŒ‡æ¨™ | âŒ |
| `/chat` | POST | èŠå¤©å®Œæˆ | âœ… |
| `/embed` | POST | æ–‡å­—åµŒå…¥ | âœ… |
| `/rerank` | POST | çµæœé‡æ’ | âœ… |
| `/index/chunks` | POST | ç´¢å¼•æ–‡å­—å¡Š | âœ… |
| `/search` | POST | å‘é‡æœç´¢ | âœ… |
| `/retrieve` | POST | æ··åˆæª¢ç´¢ | âœ… |
| `/graph/probe` | POST | æ¸¬è©¦ä¾›æ‡‰å•† JSON èƒ½åŠ› | âœ… |
| `/graph/extract` | POST | æŠ½å–çŸ¥è­˜åœ–è­œ | âœ… |
| `/graph/upsert` | POST | æ’å…¥/æ›´æ–°åœ–è­œ | âœ… |
| `/graph/query` | POST | Cypher æŸ¥è©¢ | âœ… |

### 2. LiteLLM Proxy

**è·è²¬**ï¼š
- çµ±ä¸€å¤šä¾›æ‡‰å•† LLM APIï¼ˆOpenAI ç›¸å®¹ï¼‰
- Token ç”¨é‡è¿½è¹¤å’Œé™åˆ¶
- è‡ªå‹• fallback å’Œé‡è©¦
- è«‹æ±‚æ—¥èªŒå’Œæˆæœ¬çµ±è¨ˆ

**æ”¯æ´çš„ä¾›æ‡‰å•†**ï¼š
- OpenAI (gpt-4o-mini, o1-mini)
- Google Gemini (gemini-1.5-flash-8b)
- OpenRouter (å¤šç¨®æ¨¡å‹)
- Groq (llama, mixtral)
- Ollama (æœ¬åœ°æ¨¡å‹)

**TokenCap æ’ä»¶**ï¼š
- æ¯æ—¥ OpenAI token ç”¨é‡ä¸Šé™
- è‡ªå‹•åˆ‡æ›åˆ°å…è²»ä¾›æ‡‰å•†ï¼ˆGeminiï¼‰
- JSON Schema æ³¨å…¥ï¼ˆåœ–è­œæŠ½å–ï¼‰
- çµæ§‹åŒ–æ—¥èªŒå’Œäº‹ä»¶è¿½è¹¤

**é…ç½®æ–‡ä»¶**ï¼š`configs/litellm.config.yaml`

### 3. å‘é‡è³‡æ–™åº« (Qdrant)

**è·è²¬**ï¼š
- å„²å­˜æ–‡å­—åµŒå…¥å‘é‡
- é«˜æ•ˆå‘é‡ç›¸ä¼¼åº¦æœç´¢
- å…ƒæ•¸æ“šéæ¿¾

**ç‰¹é»**ï¼š
- é–‹æºã€å…è²»ã€æœ¬åœ°éƒ¨ç½²
- æ”¯æ´å¤šç¨®è·é›¢åº¦é‡ï¼ˆCosineã€Euclideanã€Dot Productï¼‰
- Collection éš”é›¢ï¼ˆå¤šç§Ÿæˆ¶æ”¯æŒï¼‰
- RESTful API

**è³‡æ–™çµæ§‹**ï¼š
```json
{
  "id": "doc_id_chunk_1",
  "vector": [0.1, 0.2, ...],  // 1024-dim (bge-m3)
  "payload": {
    "text": "åŸå§‹æ–‡å­—å…§å®¹",
    "doc_id": "document_identifier",
    "metadata": {
      "source": "file.md",
      "chunk_id": "chunk_1",
      "timestamp": "2025-10-18T10:00:00Z"
    }
  }
}
```

### 4. çŸ¥è­˜åœ–è­œ (Neo4j)

**è·è²¬**ï¼š
- å„²å­˜å¯¦é«”å’Œé—œä¿‚
- åœ–è­œæŸ¥è©¢å’Œéæ­·
- çŸ¥è­˜æ¨ç†

**è³‡æ–™æ¨¡å‹**ï¼š
- **ç¯€é» (Node)**ï¼šå¯¦é«”ï¼Œå¸¶é¡å‹å’Œå±¬æ€§
- **é‚Š (Edge/Relationship)**ï¼šé—œä¿‚ï¼Œå¸¶é¡å‹å’Œå±¬æ€§

**Schema è¨­è¨ˆ** (`schemas/graph_schema.json`)ï¼š
```json
{
  "type": "object",
  "properties": {
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "type": {"type": "string"},
          "props": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "key": {"type": "string"},
                "value": {"type": ["string", "number", "boolean"]}
              }
            }
          }
        }
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "src": {"type": "string"},
          "dst": {"type": "string"},
          "type": {"type": "string"},
          "props": {"type": "array"}
        }
      }
    }
  }
}
```

**åœ–è­œæŠ½å–æµç¨‹**ï¼š
1. LLM è®€å–æ–‡å­—ï¼ŒæŒ‰ JSON Schema æŠ½å–å¯¦é«”å’Œé—œä¿‚
2. é©—è­‰ JSON æ ¼å¼å’Œå…§å®¹
3. å¦‚å¤±æ•—ä¸” `repair_if_invalid=true`ï¼Œå˜—è©¦ä¿®å¾©
4. å¦‚ä»å¤±æ•—ï¼Œå˜—è©¦ä¸‹ä¸€å€‹ä¾›æ‡‰å•†ï¼ˆfallback chainï¼‰
5. æˆåŠŸå¾Œ upsert åˆ° Neo4j

### 5. æœ¬åœ°åµŒå…¥ (Ollama + bge-m3)

**è·è²¬**ï¼š
- æœ¬åœ°ç”Ÿæˆæ–‡å­—åµŒå…¥å‘é‡
- æ”¯æ´ä¸­è‹±æ–‡å¤šèªè¨€
- 1024 ç¶­å‘é‡

**æ¨¡å‹**ï¼š`bge-m3`ï¼ˆBAAI/bge-m3ï¼‰
- åƒæ•¸é‡ï¼š~560M
- æœ€å¤§é•·åº¦ï¼š8192 tokens
- èªè¨€ï¼šä¸­æ–‡ã€è‹±æ–‡ã€å¤šèªè¨€

**API**ï¼š
```bash
POST http://localhost:9143/api/embeddings
{
  "model": "bge-m3",
  "prompt": "æ–‡å­—å…§å®¹"
}
```

### 6. é‡æ’åºæœå‹™ (Reranker)

**è·è²¬**ï¼š
- é‡æ–°æ’åºæª¢ç´¢çµæœ
- æå‡ç›¸é—œæ€§ç²¾ç¢ºåº¦

**æ¨¡å‹**ï¼š`BAAI/bge-reranker-v2-m3`
- äº¤å‰ç·¨ç¢¼å™¨æ¶æ§‹ï¼ˆCross-Encoderï¼‰
- è¼¸å…¥ï¼šQuery + Document
- è¼¸å‡ºï¼šç›¸é—œæ€§åˆ†æ•¸ (0-1)

**GPU åŠ é€Ÿ**ï¼š
- CUDA 12.x
- bfloat16 ç²¾åº¦
- æ‰¹æ¬¡è™•ç†

**API**ï¼š
```bash
POST http://localhost:9080/rerank
{
  "query": "æŸ¥è©¢æ–‡å­—",
  "documents": ["æ–‡æª”1", "æ–‡æª”2", ...],
  "top_n": 3
}
```

### 7. Ingestor æ–‡ä»¶è™•ç†æœå‹™

**è·è²¬**ï¼š
- æƒæå’Œè®€å–æ–‡ä»¶
- æ–‡å­—åˆ‡åˆ†ï¼ˆChunkingï¼‰
- æ‰¹æ¬¡ç´¢å¼•åˆ° Qdrant
- æ‰¹æ¬¡åœ–è­œæŠ½å–

**æ”¯æ´æ ¼å¼**ï¼š
- Markdown (.md)
- ç´”æ–‡å­— (.txt)
- JSON (.json)
- æœªä¾†ï¼šPDF, DOCX, HTML

**åˆ‡åˆ†ç­–ç•¥**ï¼š
```python
def _simple_chunk_text(text: str, chunk_size: int, overlap: int):
    """ç°¡å–®çš„æ»‘å‹•çª—å£åˆ‡åˆ†"""
    chunks = []
    start = 0
    while start < len(text):
        end = start + chunk_size
        chunk = text[start:end]
        chunks.append(chunk)
        start += chunk_size - overlap
    return chunks
```

---

## æ•¸æ“šæµç¨‹

### 1. æ–‡ä»¶æ”å–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…  â”‚
â”‚ä¸Šå‚³æ–‡ä»¶ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ingestor CLI                       â”‚
â”‚  python cli.py --path /data         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º 1. æƒææ–‡ä»¶ (*.md, *.txt)
     â”‚
     â”œâ”€â–º 2. è®€å–å…§å®¹
     â”‚
     â”œâ”€â–º 3. æ–‡å­—åˆ‡åˆ†
     â”‚      â”œâ”€ chunk_size: 1000
     â”‚      â””â”€ overlap: 200
     â”‚
     â”œâ”€â–º 4. æ‰¹æ¬¡åµŒå…¥
     â”‚      â””â”€â–º POST /embed (Ollama + bge-m3)
     â”‚
     â”œâ”€â–º 5. ç´¢å¼•åˆ° Qdrant
     â”‚      â””â”€â–º POST /index/chunks
     â”‚
     â””â”€â–º 6. åœ–è­œæŠ½å–ï¼ˆå¯é¸ï¼‰
            â””â”€â–º POST /graph/extract
                 â””â”€â–º å„²å­˜åˆ° Neo4j
```

### 2. æ··åˆæª¢ç´¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…  â”‚
â”‚æŸ¥è©¢è«‹æ±‚ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway: POST /retrieve            â”‚
â”‚  {                                  â”‚
â”‚    "query": "ä»€éº¼æ˜¯ LiteLLM?",       â”‚
â”‚    "top_k": 5,                      â”‚
â”‚    "use_graph": true                â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º 1. ç”Ÿæˆ Query åµŒå…¥
     â”‚      â””â”€â–º POST /embed
     â”‚
     â”œâ”€â–º 2. å‘é‡æœç´¢
     â”‚      â””â”€â–º Qdrant ç›¸ä¼¼åº¦æœç´¢
     â”‚           â””â”€â–º è¿”å› Top-K çµæœ
     â”‚
     â”œâ”€â–º 3. åœ–è­œæŸ¥è©¢ï¼ˆå¦‚æœ use_graph=trueï¼‰
     â”‚      â”œâ”€ æå– Query å¯¦é«”
     â”‚      â””â”€â–º Neo4j Cypher æŸ¥è©¢
     â”‚           â””â”€â–º è¿”å›ç›¸é—œç¯€é»å’Œé—œä¿‚
     â”‚
     â”œâ”€â–º 4. çµæœåˆä½µ
     â”‚      â””â”€ å‘é‡çµæœ + åœ–è­œçµæœ
     â”‚
     â”œâ”€â–º 5. é‡æ’åºï¼ˆå¯é¸ï¼‰
     â”‚      â””â”€â–º POST /rerank
     â”‚           â””â”€â–º è¿”å›é‡æ’å¾Œçš„ Top-N
     â”‚
     â””â”€â–º 6. è¿”å›æœ€çµ‚çµæœ
```

### 3. èŠå¤©è£œå…¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…  â”‚
â”‚èŠå¤©è«‹æ±‚ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway: POST /chat                â”‚
â”‚  {                                  â”‚
â”‚    "model": "rag-answer",           â”‚
â”‚    "messages": [...]                â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º 1. èªè­‰æª¢æŸ¥
     â”‚      â””â”€ X-API-Key é©—è­‰
     â”‚
     â”œâ”€â–º 2. æª¢ç´¢ç›¸é—œä¸Šä¸‹æ–‡ï¼ˆRAGï¼‰
     â”‚      â”œâ”€â–º POST /retrieve
     â”‚      â””â”€â–º è¿”å›ç›¸é—œæ–‡æª”
     â”‚
     â”œâ”€â–º 3. æ§‹å»ºå¢å¼·æç¤ºè©
     â”‚      â””â”€ System + Context + User Query
     â”‚
     â”œâ”€â–º 4. LLM æ¨ç†
     â”‚      â””â”€â–º LiteLLM Proxy
     â”‚           â”œâ”€ æª¢æŸ¥ Token Cap
     â”‚           â”œâ”€ é¸æ“‡ä¾›æ‡‰å•†
     â”‚           â”‚   â”œâ”€ OpenAI (gpt-4o-mini)
     â”‚           â”‚   â””â”€ Fallback â†’ Gemini
     â”‚           â””â”€â–º è¿”å›å›ç­”
     â”‚
     â””â”€â–º 5. è¿”å›çµæœ
```

### 4. çŸ¥è­˜åœ–è­œæŠ½å–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…   â”‚
â”‚æŠ½å–è«‹æ±‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway: POST /graph/extract        â”‚
â”‚  {                                   â”‚
â”‚    "context": "Nick æ–¼ 2022 åŠ å…¥...", â”‚
â”‚    "strict": true,                   â”‚
â”‚    "repair_if_invalid": true         â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º 1. è¼‰å…¥ JSON Schema
     â”‚      â””â”€ schemas/graph_schema.json
     â”‚
     â”œâ”€â–º 2. æ§‹å»ºæŠ½å–æç¤ºè©
     â”‚      â”œâ”€ Schema æ³¨å…¥
     â”‚      â””â”€ Few-shot Examples
     â”‚
     â”œâ”€â–º 3. LLM æŠ½å–ï¼ˆé‡è©¦éˆï¼‰
     â”‚      â””â”€â–º LiteLLM Proxy
     â”‚           â”œâ”€ å˜—è©¦ graph-extractor (GPT-4o-mini)
     â”‚           â”œâ”€ JSON Mode è¼¸å‡º
     â”‚           â””â”€ è¿”å› JSON
     â”‚
     â”œâ”€â–º 4. é©—è­‰ JSON
     â”‚      â”œâ”€ Schema é©—è­‰
     â”‚      â””â”€ è³ªé‡æª¢æŸ¥ï¼ˆmin_nodes, min_edgesï¼‰
     â”‚
     â”œâ”€â–º 5. å¤±æ•—ï¼Ÿ
     â”‚      â”œâ”€ Yes â†’ ä¿®å¾©å˜—è©¦ï¼ˆå¦‚ repair_if_invalid=trueï¼‰
     â”‚      â”‚         â””â”€â–º é‡æ–°ç™¼é€çµ¦ LLM ä¿®å¾©
     â”‚      â”‚
     â”‚      â””â”€ ä»å¤±æ•—ï¼Ÿ
     â”‚             â””â”€ å˜—è©¦ä¸‹ä¸€å€‹ä¾›æ‡‰å•†
     â”‚                  â”œâ”€ graph-extractor-o1mini
     â”‚                  â””â”€ graph-extractor-gemini
     â”‚
     â”œâ”€â–º 6. æˆåŠŸ
     â”‚      â””â”€â–º POST /graph/upsert
     â”‚           â””â”€ å„²å­˜åˆ° Neo4j
     â”‚
     â””â”€â–º 7. è¿”å›çµæœ
```

---

## æŠ€è¡“é¸å‹

### ç‚ºä»€éº¼é¸æ“‡é€™äº›æŠ€è¡“ï¼Ÿ

| çµ„ä»¶ | æŠ€è¡“ | åŸå›  |
|------|------|------|
| **Web æ¡†æ¶** | FastAPI | â€¢ é«˜æ€§èƒ½ ASGI<br>â€¢ è‡ªå‹• API æ–‡æª”<br>â€¢ é¡å‹æª¢æŸ¥<br>â€¢ ç•°æ­¥æ”¯æŒ |
| **LLM Proxy** | LiteLLM | â€¢ å¤šä¾›æ‡‰å•†çµ±ä¸€ API<br>â€¢ å…§å»º fallback<br>â€¢ Token è¿½è¹¤<br>â€¢ é–‹æºå…è²» |
| **å‘é‡è³‡æ–™åº«** | Qdrant | â€¢ é–‹æºå…è²»<br>â€¢ æœ¬åœ°éƒ¨ç½²<br>â€¢ é«˜æ€§èƒ½<br>â€¢ RESTful API |
| **åœ–è³‡æ–™åº«** | Neo4j | â€¢ æˆç†Ÿç©©å®š<br>â€¢ Cypher æŸ¥è©¢èªè¨€<br>â€¢ ç¤¾ç¾¤ç‰ˆå…è²»<br>â€¢ APOC æ“´å±• |
| **åµŒå…¥æ¨¡å‹** | bge-m3 | â€¢ ä¸­è‹±æ–‡å„ªç§€<br>â€¢ é–‹æºå…è²»<br>â€¢ 1024 ç¶­<br>â€¢ å¯æœ¬åœ°é‹è¡Œ |
| **Reranker** | bge-reranker-v2-m3 | â€¢ é«˜ç²¾åº¦<br>â€¢ é–‹æºå…è²»<br>â€¢ GPU åŠ é€Ÿ<br>â€¢ å¤šèªè¨€æ”¯æŒ |
| **å®¹å™¨åŒ–** | Docker Compose | â€¢ ä¸€éµéƒ¨ç½²<br>â€¢ ç’°å¢ƒéš”é›¢<br>â€¢ æ˜“æ–¼æ“´å±•<br>â€¢ ç”Ÿç”¢å°±ç·’ |
| **æ—¥èªŒ** | Python logging | â€¢ æ¨™æº–åº«<br>â€¢ çµæ§‹åŒ–æ—¥èªŒ<br>â€¢ å¯æ“´å±•<br>â€¢ ELK/Loki ç›¸å®¹ |
| **æŒ‡æ¨™** | Prometheus | â€¢ æ¥­ç•Œæ¨™æº–<br>â€¢ æ™‚åºè³‡æ–™<br>â€¢ Grafana æ•´åˆ<br>â€¢ æŸ¥è©¢èªè¨€å¼·å¤§ |

### æˆæœ¬å„ªåŒ–ç­–ç•¥

1. **æœ¬åœ°æ¨ç†å„ªå…ˆ**ï¼š
   - Ollama åµŒå…¥ï¼ˆå…è²»ï¼‰
   - PyTorch Rerankerï¼ˆå…è²»ï¼‰

2. **å…è²» API é…é¡**ï¼š
   - Gemini Flash 8Bï¼ˆå¤§é…é¡ï¼‰
   - Groqï¼ˆå¿«é€Ÿå…è²»æ¨ç†ï¼‰

3. **Token Cap**ï¼š
   - æ¯æ—¥ OpenAI ç”¨é‡ä¸Šé™
   - è‡ªå‹•åˆ‡æ›åˆ°å…è²»ä¾›æ‡‰å•†

4. **å¿«å–ç­–ç•¥**ï¼š
   - Redis å¿«å–åµŒå…¥å‘é‡
   - LLM å›ç­”å¿«å–ï¼ˆæœªä¾†ï¼‰

---

## éƒ¨ç½²æ¶æ§‹

### å–®æ©Ÿéƒ¨ç½² (v0.1.x)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Docker Host                           â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Gateway â”‚  â”‚ LiteLLM  â”‚  â”‚ Ingestor â”‚              â”‚
â”‚  â”‚  :9800   â”‚  â”‚  :9400   â”‚  â”‚  :9900   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚             â”‚              â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”               â”‚
â”‚  â”‚                                      â”‚              â”‚
â”‚  â–¼              â–¼              â–¼        â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Qdrant  â”‚  â”‚  Neo4j   â”‚  â”‚  Redis   â”‚  â”‚ PG   â”‚    â”‚
â”‚  â”‚  :9333   â”‚  â”‚  :9474   â”‚  â”‚  :9379   â”‚  â”‚ :5432â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  Ollama  â”‚  â”‚ Reranker â”‚                            â”‚
â”‚  â”‚  :9143   â”‚  â”‚  :9080   â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”                              â”‚
â”‚  â”‚      GPU (Optional)  â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç³»çµ±éœ€æ±‚**ï¼š
- **CPU**: 4 æ ¸å¿ƒä»¥ä¸Š
- **è¨˜æ†¶é«”**: 16GB ä»¥ä¸Šï¼ˆ32GB å»ºè­°ï¼‰
- **ç£ç¢Ÿ**: 50GB ä»¥ä¸Š SSD
- **GPU**: NVIDIA GPUï¼ˆé¸å¡«ï¼Œç”¨æ–¼ Reranker å’Œ Ollama åŠ é€Ÿï¼‰

### åˆ†æ•£å¼éƒ¨ç½² (v0.4.0 è¨ˆåŠƒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Load Balancer                         â”‚
â”‚                    (Nginx / HAProxy)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Gateway  â”‚    â”‚ Gateway  â”‚    â”‚ Gateway  â”‚
  â”‚ Instance â”‚    â”‚ Instance â”‚    â”‚ Instance â”‚
  â”‚    #1    â”‚    â”‚    #2    â”‚    â”‚    #3    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Qdrant  â”‚    â”‚  Neo4j   â”‚    â”‚ LiteLLM  â”‚
  â”‚ Cluster  â”‚    â”‚ Cluster  â”‚    â”‚ Cluster  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Redis   â”‚
                  â”‚ Cluster  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ€§èƒ½è€ƒé‡

### ç•¶å‰æ€§èƒ½ï¼ˆv0.1.xï¼‰

| æ“ä½œ | å»¶é² (P95) | ååé‡ | å‚™è¨» |
|------|-----------|--------|------|
| **å‘é‡æœç´¢** | ~200ms | ~10 QPS | å–®æ©Ÿ Qdrant |
| **åœ–è­œæŸ¥è©¢** | ~150ms | ~15 QPS | ç°¡å–® Cypher |
| **åµŒå…¥ç”Ÿæˆ** | ~500ms/batch | ~20 QPS | bge-m3, batch=10 |
| **é‡æ’åº** | ~300ms/batch | ~5 QPS | GPU åŠ é€Ÿ |
| **åœ–è­œæŠ½å–** | ~5s | ~2 QPS | å« LLM æ¨ç† |

### æ€§èƒ½ç“¶é ¸

1. **åŒæ­¥ I/O**ï¼šç›®å‰å¤§éƒ¨åˆ†æ“ä½œæ˜¯åŒæ­¥çš„
2. **å–®ç·šç¨‹è™•ç†**ï¼šæœªå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU
3. **ç¶²çµ¡å¾€è¿”**ï¼šå¤šæ¬¡æœå‹™é–“èª¿ç”¨
4. **LLM å»¶é²**ï¼šé›²ç«¯ API å»¶é²é«˜

### v0.2.0 å„ªåŒ–è¨ˆåŠƒ

- **ç•°æ­¥åŒ–**ï¼šæ‰€æœ‰ I/O æ“ä½œæ”¹ç‚º async/await
- **æ‰¹æ¬¡è™•ç†**ï¼šåµŒå…¥ã€é‡æ’åºæ‰¹æ¬¡åŒ–
- **é€£æ¥æ± **ï¼šè³‡æ–™åº«é€£æ¥æ± å„ªåŒ–
- **å¿«å–å±¤**ï¼šRedis å¿«å–ç†±é–€æŸ¥è©¢

**ç›®æ¨™**ï¼š
- ååé‡æå‡ 3-5x
- P95 å»¶é²é™ä½ 30-40%

---

## å®‰å…¨è¨­è¨ˆ

### èªè­‰èˆ‡æˆæ¬Š

**API Key èªè­‰**ï¼š
```python
# åœ¨ HTTP Header ä¸­å‚³é
X-API-Key: dev-key

# æˆ–ä½¿ç”¨ Bearer Token
Authorization: Bearer dev-key
```

**å¤š Key æ”¯æŒ**ï¼ˆv0.4.0ï¼‰ï¼š
```bash
# .env ä¸­é…ç½®å¤šå€‹ Key
API_GATEWAY_KEYS=prod-key-1,prod-key-2,dev-key
```

### è³‡æ–™å®‰å…¨

1. **å‚³è¼¸åŠ å¯†**ï¼š
   - ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ HTTPS/TLS
   - å…§éƒ¨é€šè¨Šå¯ä½¿ç”¨ Docker ç¶²çµ¡éš”é›¢

2. **å„²å­˜åŠ å¯†**ï¼š
   - æ•æ„Ÿè³‡æ–™ï¼ˆAPI Keysï¼‰ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
   - è³‡æ–™åº«å¯†ç¢¼åŠ å¯†å„²å­˜

3. **æ—¥èªŒè„«æ•**ï¼š
   - API Keys ä¸è¨˜éŒ„åœ¨æ—¥èªŒä¸­
   - æ•æ„Ÿè³‡æ–™è‡ªå‹•é®ç½©

### è¼¸å…¥é©—è­‰

```python
# Pydantic æ¨¡å‹è‡ªå‹•é©—è­‰
class ChatReq(BaseModel):
    model: str = Field(..., min_length=1, max_length=100)
    messages: List[Message] = Field(..., min_items=1, max_items=100)
    temperature: float = Field(0.7, ge=0.0, le=2.0)
```

### æ³¨å…¥æ”»æ“Šé˜²è­·

- **Cypher æ³¨å…¥**ï¼šä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
- **SQL æ³¨å…¥**ï¼šORM å’Œåƒæ•¸åŒ–æŸ¥è©¢
- **Prompt æ³¨å…¥**ï¼šè¼¸å…¥é•·åº¦å’Œå­—ç¬¦é™åˆ¶

---

## æ“´å±•æ€§è¨­è¨ˆ

### æ°´å¹³æ“´å±•

**ç„¡ç‹€æ…‹è¨­è¨ˆ**ï¼š
- Gateway æœå‹™ç„¡ç‹€æ…‹ï¼Œå¯ä»»æ„æ“´å±•
- ç‹€æ…‹å„²å­˜åœ¨å¤–éƒ¨æœå‹™ï¼ˆRedisã€PostgreSQLï¼‰

**è² è¼‰å‡è¡¡**ï¼š
```nginx
upstream gateway {
    server gateway-1:8000;
    server gateway-2:8000;
    server gateway-3:8000;
}
```

### å‚ç›´æ“´å±•

**è³‡æºé…ç½®**ï¼š
```yaml
# docker-compose.yml
services:
  apigw:
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
```

### è³‡æ–™åº«æ“´å±•

**Qdrant åˆ†ç‰‡**ï¼š
```python
# æŒ‰ç§Ÿæˆ¶åˆ† Collection
collection_name = f"tenant_{tenant_id}"
```

**Neo4j åˆ†ç‰‡**ï¼ˆæœªä¾†ï¼‰ï¼š
- æŒ‰æ¥­å‹™é ˜åŸŸåˆ†åº«
- Federation æŸ¥è©¢

---

## ç›¸é—œæ–‡æª”

- [API ä½¿ç”¨æŒ‡å—](zh/api_usage.md)
- [æ•…éšœæ’æŸ¥æŒ‡å—](troubleshooting.md)
- [ç”¢å“è·¯ç·šåœ–](../ROADMAP.md)
- [è²¢ç»æŒ‡å—](../CONTRIBUTING.md)

---

**ä½œè€…**: tc3oliver
**ç‰ˆæœ¬**: v0.1.2
**æœ€å¾Œæ›´æ–°**: 2025-10-18
